{"version":3,"sources":["components/astrology/zegocloud/VideoCall.js"],"names":["i","randomID","len","result","chars","maxPos","length","charAt","Math","floor","random","getUrlParams","url","window","location","href","urlStr","split","URLSearchParams","App","useState","timer","setTimer","toggle","setToggle","ref","useRef","history","useHistory","useEffect","current","setInterval","clearInterval","handlestartinterval","userId","JSON","parse","localStorage","getItem","astroId","sessionStorage","setItem","payload","type","console","log","axiosConfig","post","then","res","data","Fetchuserdetail","catch","err","response","message","handlestop","props","push","swal","handleStop","roomID","get","myMeeting","element","name","Userinfo","full_name","toString","kitToken","ZegoUIKitPrebuilt","generateKitTokenForTest","zp","create","userID","joinRoom","container","maxUsers","sharedLinks","protocol","host","pathname","scenario","mode","OneONoneCall","preJoinViewConfig","title","onJoinRoom","obj","astroid","videoLink","userid","error","onLeaveRoom","value","removeItem","onUserJoin","onUserLeave","showScreenSharingButton","className","getSeconds","slice","minutes","getMinutes","getHours","formatTime","style","width","height"],"mappings":"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","file":"static/js/181.72676816.chunk.js","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport axiosConfig from \"../../../axiosConfig\";\n// import { getUserID } from \"../astrologerdetail\";\nimport { ZegoUIKitPrebuilt } from \"@zegocloud/zego-uikit-prebuilt\";\nimport { useHistory } from \"react-router-dom\";\n\nimport swal from \"sweetalert\";\nimport { Fetchuserdetail } from \"../../header/IconGroup\";\nfunction randomID(len) {\n  let result = \"\";\n  if (result) return result;\n  var chars = \"12345qwertyuiopasdfgh67890jklmnbvcxzMNBVCZXASDQWERTYHGFUIOLKJP\",\n    maxPos = chars.length,\n    i;\n  len = len || 5;\n  for (i = 0; i < len; i++) {\n    result += chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return result;\n}\n\nexport function getUrlParams(url = window.location.href) {\n  let urlStr = url.split(\"?\")[1];\n  return new URLSearchParams(urlStr);\n}\nexport default function App() {\n  const [timer, setTimer] = useState(0);\n  const [toggle, setToggle] = useState(false);\n  let ref = useRef();\n  const history = useHistory();\n  useEffect(() => {\n    if (toggle) {\n      ref.current = setInterval(() => setTimer(timer => timer + 1), 1000);\n    }\n    return () => {\n      clearInterval(ref.current);\n    };\n  }, [toggle]);\n  // useEffect(() => {\n  //   let id = localStorage.getItem(\"astroId\");\n  //   axiosConfig.get(`/admin/getoneAstro/${id}`).then(res => {\n  //     // console.log(res.data.data);\n  //   });\n  // }, []);\n  const handleStart = () => {\n    setToggle(true);\n    handlestartinterval();\n  };\n\n  const handlestartinterval = () => {\n    ref.current = setInterval(() => {\n      let userId = JSON.parse(localStorage.getItem(\"user_id\"));\n      let astroId = localStorage.getItem(\"astroId\");\n      sessionStorage.setItem(\"typeofcall\", \"Video\");\n\n      let payload = {\n        userId: userId,\n        astroId: astroId,\n        type: \"Video\",\n        // status: true,\n      };\n      console.log(\"payload\", payload);\n      axiosConfig\n        .post(`/user/deductChatBalance`, payload)\n        .then(res => {\n          console.log(\"callduration\", res.data);\n          Fetchuserdetail();\n        })\n        .catch(err => {\n          console.log(err.response.data.message);\n          if (\n            err.response.data.message === \"Insufficient balance for the call\"\n          ) {\n            this.handlestop();\n            this.props.history.push(\"/allastrologerlist\");\n            swal(\"You have Low Balance\");\n          }\n        });\n    }, 1000);\n  };\n  const handleStop = () => {\n    setToggle(false);\n  };\n\n  const roomID = getUrlParams().get(\"roomID\") || randomID(5);\n  const formatTime = timer => {\n    const getSeconds = `0${timer % 60}`.slice(-2);\n    const minutes = `${Math.floor(timer / 60)}`;\n    const getMinutes = `0${minutes % 60}`.slice(-2);\n    const getHours = `0${Math.floor(timer / 3600)}`.slice(-2);\n\n    return `${getHours} : ${getMinutes} : ${getSeconds}`;\n  };\n  let myMeeting = async element => {\n    // generate Kit Token\n    const appID = 1011009319;\n    const name = JSON.parse(localStorage.getItem(\"userData\"));\n    const response = name.Userinfo?.full_name || randomID(5).toString();\n    const serverSecret = \"0b7c5477f07346c1a906c99d3f171f2e\";\n    const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(\n      appID,\n      serverSecret,\n      roomID,\n      randomID(5).toString(),\n      response\n    );\n\n    // Create instance object from Kit Token.\n    const zp = ZegoUIKitPrebuilt.create(kitToken);\n    let userID = JSON.parse(localStorage.getItem(\"user_id\"));\n\n    // start the call\n\n    zp.joinRoom({\n      container: element,\n      maxUsers: 2,\n      sharedLinks: [\n        {\n          name: \"Personal link\",\n          url:\n            window.location.protocol +\n            \"//\" +\n            window.location.host +\n            \"/#/VideoCall\" +\n            window.location.pathname +\n            \"?roomID=\" +\n            roomID,\n        },\n      ],\n      scenario: {\n        mode: ZegoUIKitPrebuilt.OneONoneCall,\n      },\n      preJoinViewConfig: {\n        title: \"Join Astrologer Video Call\",\n      },\n\n      onJoinRoom: () => {\n        let obj = {\n          astroid: localStorage.getItem(\"astroId\"),\n          videoLink: roomID,\n          userid: userID,\n        };\n        axiosConfig\n          .post(\"/user/send_VideoLink\", obj)\n          .then(response => {\n            // console.log(response.data.data);\n          })\n          .catch(error => {\n            console.log(error);\n          });\n      },\n      onLeaveRoom: async () => {\n        handleStop();\n        let astroid = localStorage.getItem(\"astroId\");\n        let value = {\n          userId: userID,\n          astroId: astroid,\n        };\n        axiosConfig\n          .post(`/user/changeStatus`, value)\n          .then(res => {\n            console.log(\"CloneJob Stop\", res);\n            localStorage.removeItem(\"CurrentChat_userid\");\n            history.push(\"/astrorating\");\n          })\n          .catch(err => {\n            console.log(err.response.data);\n          });\n      },\n      onUserJoin: () => {\n        handleStart();\n      },\n      onUserLeave: async () => {\n        handleStop();\n        let astroid = localStorage.getItem(\"astroId\");\n        let value = {\n          userId: userID,\n          astroId: astroid,\n        };\n        axiosConfig\n          .post(`/user/changeStatus`, value)\n          .then(res => {\n            console.log(\"CloneJob Stop astrooo\", res);\n            localStorage.removeItem(\"CurrentChat_userid\");\n            history.push(\"/astrorating\");\n          })\n          .catch(err => {\n            console.log(err.response.data);\n          });\n      },\n\n      showScreenSharingButton: false,\n    });\n  };\n\n  return (\n    <div>\n      <div className=\" timer\">\n        <div className=\"currentTime\">Current timer - {formatTime(timer)}</div>\n      </div>\n      <div\n        className=\"myCallContainer\"\n        ref={myMeeting}\n        style={{ width: \"100vw\", height: \"100vh\" }}\n      ></div>\n    </div>\n  );\n}\n"],"sourceRoot":""}